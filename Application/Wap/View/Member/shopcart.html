<extend name="Public/base" />
<block name="main">
    <body>
    <header class="bgz colb">
    		<span class="pfr local pfr">
    			<span class="jiaob poab bgr colb fs12 textcen lh14">3</span>
    		</span>
        <span class="fr changeview toggle" style="display: none;">编辑</span>
        <span class="fr changeview toggle">完成</span>
        <span>购物车</span>
    </header>
    <div class="content" style="padding: 50px 0px 110px;">
        <div class="goodlist ovhid">
        </div>
    </div>
    <div class="disib gohead top_gohead">
        <img src="__IMG__/gohead.png" />
    </div>
    <div class="botarea lh50 bgb" style="bottom: 60px;">
        <div class="fr toggle">
            <span class="fr bgbtn pad0-10 colb">结算（<span class="totalnum"></span>）</span>
				<span class="fr mar10 cole textrig">
					<div class="lh30">合计：<span class="colr">￥<span class="totalprice"></span></span></div>
					<div class="lh20 fs12">含运费：￥20</div>
				</span>
        </div>
        <div class="toggle fr" style="display:none;">
            <span class="bgbtn colb fr pad0-20">删除</span>
            <span class="colb fr bgyel pad0-10">移到收藏夹</span>
        </div>

        <span class="gleygood disib all">全选</span>
    </div>
    <footer class="bgz">
        <div linkto="{:U('Index/index')}">
            <span>首页</span>
        </div>
        <div linkto="{:U('Index/discover')}">
            <span>发现</span>
        </div>
        <div linkto="{:U('Member/collection')}">
            <span>收藏</span>
        </div>
        <div class="on">
            <span>购物车</span>
        </div>
        <div linkto="{:U('Member/self')}">
            <span>我的</span>
        </div>
    </footer>
    </body>
</block>

<block name="script">
    <script type="text/javascript">
        $(".changeview").on('click',function(){
            $(".toggle").toggle();
        });
        $(".all").on('click',function(){
            var self = $(this);
            if (self.hasClass('on')) {
                $(".top_check").removeClass("on");
            }else{
                $(".top_check").addClass("on");
            }
            self.toggleClass('on');
        });
        

        var totalprice = 0;
        var totalnum = 0;
        if (!top_user)getUserInfo("{:U('Member/login')}");
        requestUrl("{:U('Api/Cart/cartList')}",{m_id:top_user.m_id},viewAddress);

        function viewAddress(res){
            if (res.flag == "success") {
                var str = "";
                for(var good of res.data.goods){
                    str += '<div class="good bgb borb31">'
                                +'<div class="top_check gleygood fl100"></div>'
                                +'<div class="imgbag">'
                                    +'<img src="'+good.goods_pic+'" />'
                                +'</div>'
                                +'<div class="pad0-10 goodinfo toggle">'
                                    +'<div class="goodname fs14" linkto="goodinfo.html">'
                                        +good.goods_name
                                    +'</div>'
                                    +'<div class="cole fs12">'+good.product+'</div>'
                                    +'<div class="lh30 price fs14">'
                                        +'<span class="fr goodnum">x'+good.num+'</span>'
                                        +'<span class="fs16 colr">￥'+good.price+'</span>'
                                    +'</div>'
                                +'</div>'
                                +'<div class="playgood pore toggle" style="display: none;">'
                                    +'<div class="bgc playbtn disf cole lh20 fs14">'
                                        +'<div class="iconggley" goods_id="'+good.goods_id+'">'
                                            +'<span>移入收藏</span>'
                                        +'</div>'
                                        +'<div class="icongdel" cart_id="'+good.cart_id+'">'
                                            +'<span>删除</span>'
                                        +'</div>'
                                    +'</div>'
                                    +'<div class="pfr poab localmana" goodprice="'+good.price+'">'
                                        +'<span class="iconadd"></span>'
                                        +'<span class="bge goodnum">'+good.num+'</span>'
                                        +'<span class="iconjian"></span>'
                                    +'</div>'
                                +'</div>'
                            +'</div>';
                            totalnum += parseInt(good.num);
                            totalprice += good.num * good.price;
                }
                $(".totalnum").text(totalnum);
                $(".totalprice").text(totalprice);
                $(".goodlist").html(str);
                top_check();
            }else{
                alert(res.message);
            }
        }
    </script>
</block>